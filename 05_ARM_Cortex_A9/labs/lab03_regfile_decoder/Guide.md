# Lab 3: å¯„å­˜å™¨æ–‡ä»¶ä¸è¯‘ç å•å…ƒè®¾è®¡

## ğŸ“‹ å®éªŒæ¦‚è¿°

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **å®éªŒåç§°** | å¯„å­˜å™¨æ–‡ä»¶ä¸è¯‘ç å•å…ƒè®¾è®¡ |
| **é¢„è®¡æ—¶é•¿** | 8-10 å°æ—¶ |
| **éš¾åº¦ç­‰çº§** | â­â­â­â˜†â˜† |
| **å‰ç½®å®éªŒ** | Lab 1, Lab 2 |

## ğŸ¯ å®éªŒç›®æ ‡

1. å®ç° ARM å¤„ç†å™¨çš„ 16 ä¸ª 32 ä½é€šç”¨å¯„å­˜å™¨
2. è®¾è®¡å¤šç«¯å£å¯„å­˜å™¨æ–‡ä»¶ï¼ˆ3è¯»1å†™ï¼‰
3. å®ç°å®Œæ•´çš„ ARM æŒ‡ä»¤è¯‘ç å™¨
4. ç”Ÿæˆæµæ°´çº¿æ§åˆ¶ä¿¡å·
5. ç†è§£ ARM æŒ‡ä»¤ç¼–ç æ ¼å¼

---

## ğŸ“š ç†è®ºèƒŒæ™¯

### ARM å¯„å­˜å™¨ç»„ç»‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ARM Register Bank                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  R0  â”‚ General Purpose â”‚ ä¹Ÿç”¨ä½œå‡½æ•°è¿”å›å€¼                   â”‚
â”‚  R1  â”‚ General Purpose â”‚                                   â”‚
â”‚  R2  â”‚ General Purpose â”‚                                   â”‚
â”‚  R3  â”‚ General Purpose â”‚                                   â”‚
â”‚  R4  â”‚ General Purpose â”‚ Variable Register                 â”‚
â”‚  R5  â”‚ General Purpose â”‚ Variable Register                 â”‚
â”‚  R6  â”‚ General Purpose â”‚ Variable Register                 â”‚
â”‚  R7  â”‚ General Purpose â”‚ Variable Register                 â”‚
â”‚  R8  â”‚ General Purpose â”‚ Variable Register                 â”‚
â”‚  R9  â”‚ General Purpose â”‚ Platform Register (SB)            â”‚
â”‚  R10 â”‚ General Purpose â”‚ Variable Register                 â”‚
â”‚  R11 â”‚ General Purpose â”‚ Frame Pointer (FP)                â”‚
â”‚  R12 â”‚ General Purpose â”‚ Intra-Procedure-call (IP)         â”‚
â”‚  R13 â”‚ Stack Pointer   â”‚ SP - æ ˆæŒ‡é’ˆ                        â”‚
â”‚  R14 â”‚ Link Register   â”‚ LR - é“¾æ¥å¯„å­˜å™¨ï¼ˆè¿”å›åœ°å€ï¼‰         â”‚
â”‚  R15 â”‚ Program Counter â”‚ PC - ç¨‹åºè®¡æ•°å™¨                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CPSR â”‚ Current Program Status Register                      â”‚
â”‚ SPSR â”‚ Saved Program Status Register (å¼‚å¸¸æ¨¡å¼)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ARM æŒ‡ä»¤æ ¼å¼è¯¦è§£

#### æ•°æ®å¤„ç†æŒ‡ä»¤ (Data Processing)

```
31  28 27 26 25 24       21 20 19    16 15    12 11           0
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cond â”‚ 00  â”‚I â”‚  Opcode  â”‚S â”‚   Rn   â”‚   Rd   â”‚   Operand2   â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Cond:    æ¡ä»¶ç  (4ä½)
I:       ç«‹å³æ•°æ ‡å¿— (0=å¯„å­˜å™¨, 1=ç«‹å³æ•°)
Opcode:  æ“ä½œç  (4ä½ï¼Œè§ ALU æ“ä½œè¡¨)
S:       æ›´æ–°æ ‡å¿—ä½ (1=æ›´æ–° CPSR)
Rn:      ç¬¬ä¸€æºå¯„å­˜å™¨ (4ä½)
Rd:      ç›®çš„å¯„å­˜å™¨ (4ä½)
Operand2: ç¬¬äºŒæ“ä½œæ•° (12ä½)
```

#### Load/Store æŒ‡ä»¤ (Single Data Transfer)

```
31  28 27 26 25 24 23 22 21 20 19    16 15    12 11           0
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cond â”‚ 01  â”‚I â”‚P â”‚U â”‚B â”‚W â”‚L â”‚   Rn   â”‚   Rd   â”‚   Offset     â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

I:  åç§»ç±»å‹ (0=ç«‹å³æ•°, 1=å¯„å­˜å™¨)
P:  Pre/Post indexing (0=åç´¢å¼•, 1=å‰ç´¢å¼•)
U:  Up/Down (0=å‡, 1=åŠ )
B:  Byte/Word (0=å­—, 1=å­—èŠ‚)
W:  Write-back (1=å†™å›åŸºå€)
L:  Load/Store (0=Store, 1=Load)
Rn: åŸºå€å¯„å­˜å™¨
Rd: æº/ç›®çš„å¯„å­˜å™¨
```

#### åˆ†æ”¯æŒ‡ä»¤ (Branch)

```
31  28 27 26 25 24 23                                         0
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cond â”‚ 101 â”‚L â”‚  â”‚              Offset (24ä½)               â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

L:      Link (1=ä¿å­˜è¿”å›åœ°å€åˆ° LR)
Offset: ç¬¦å·æ‰©å±•åå·¦ç§»2ä½ï¼ŒåŠ åˆ° PC+8
        ç›®æ ‡åœ°å€ = PC + 8 + (SignExtend(Offset) << 2)
```

#### ä¹˜æ³•æŒ‡ä»¤ (Multiply)

```
31  28 27    24 23 22 21 20 19    16 15    12 11     8 7    4 3      0
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cond â”‚ 000000 â”‚A â”‚S â”‚  â”‚  â”‚   Rd   â”‚   Rn   â”‚   Rs   â”‚ 1001 â”‚   Rm   â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

A:  Accumulate (1=MLA, 0=MUL)
S:  æ›´æ–°æ ‡å¿—
Rd: ç›®çš„å¯„å­˜å™¨ (ç»“æœ)
Rn: ç´¯åŠ å¯„å­˜å™¨ (ä»… MLA)
Rs: ä¹˜æ•°
Rm: è¢«ä¹˜æ•°
```

---

## ğŸ”§ å®éªŒæ­¥éª¤

### æ­¥éª¤ 1: å®ç°å¯„å­˜å™¨æ–‡ä»¶

å…³é”®è®¾è®¡è¦ç‚¹ï¼š
1. 3 ä¸ªè¯»ç«¯å£ï¼ˆæ”¯æŒ Rn, Rm, Rs åŒæ—¶è¯»å–ï¼‰
2. 1 ä¸ªå†™ç«¯å£
3. R15 (PC) éœ€è¦ç‰¹æ®Šå¤„ç†
4. æ”¯æŒå¯„å­˜å™¨æ—è·¯ï¼ˆåŒå‘¨æœŸå†™åè¯»ï¼‰

### æ­¥éª¤ 2: å®ç°æŒ‡ä»¤è¯‘ç å™¨

è¯‘ç å™¨éœ€è¦è¯†åˆ«ï¼š
1. æŒ‡ä»¤ç±»å‹ï¼ˆæ•°æ®å¤„ç†ã€Load/Storeã€åˆ†æ”¯ç­‰ï¼‰
2. æå–æ“ä½œæ•°åœ°å€
3. ç”Ÿæˆæ§åˆ¶ä¿¡å·
4. å¤„ç†ç«‹å³æ•°æ‰©å±•

### æ­¥éª¤ 3: åˆ›å»ºæµ‹è¯•å¹³å°

éªŒè¯ï¼š
1. å¯„å­˜å™¨è¯»å†™æ­£ç¡®æ€§
2. PC è®¿é—®
3. å„ç±»æŒ‡ä»¤è¯‘ç 
4. è¾¹ç•Œæ¡ä»¶

---

## ğŸ“ ä»£ç å®ç°

è¯¦è§ `src/register_file.v` å’Œ `src/decoder.v`

---

## âœ… æ£€æŸ¥ç‚¹

- [ ] å¯„å­˜å™¨æ–‡ä»¶æ”¯æŒ 3 è¯» 1 å†™
- [ ] R0 å§‹ç»ˆè¯»å‡º 0ï¼ˆå¯é€‰ï¼‰
- [ ] R15 è¿”å› PC+8ï¼ˆæµæ°´çº¿è¡¥å¿ï¼‰
- [ ] è¯‘ç å™¨è¯†åˆ«æ‰€æœ‰ä¸»è¦æŒ‡ä»¤ç±»å‹
- [ ] æ§åˆ¶ä¿¡å·æ­£ç¡®ç”Ÿæˆ
- [ ] ç«‹å³æ•°æ­£ç¡®æ‰©å±•å’Œæ—‹è½¬

---

## ğŸ”— ä¸‹ä¸€æ­¥

å®Œæˆæœ¬å®éªŒåï¼Œç»§ç»­ **Lab 4: æ‰§è¡Œå•å…ƒé›†æˆ**ã€‚

# Lab 4: æ‰§è¡Œå•å…ƒ (EXU) é›†æˆ

## ğŸ“‹ å®éªŒæ¦‚è¿°

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **å®éªŒåç§°** | æ‰§è¡Œå•å…ƒé›†æˆ |
| **é¢„è®¡æ—¶é•¿** | 6-8 å°æ—¶ |
| **éš¾åº¦ç­‰çº§** | â­â­â­â­â˜† |
| **å‰ç½®å®éªŒ** | Lab 2, Lab 3 |

## ğŸ¯ å®éªŒç›®æ ‡

1. å°† ALUã€Barrel Shifterã€ä¹˜æ³•å™¨é›†æˆä¸ºå®Œæ•´æ‰§è¡Œå•å…ƒ
2. å®ç°æ•°æ®å‰é€’ï¼ˆForwardingï¼‰é€»è¾‘
3. å¤„ç†åˆ†æ”¯ç›®æ ‡åœ°å€è®¡ç®—
4. å®ç°æ¡ä»¶æ‰§è¡Œåˆ¤æ–­

---

## ğŸ“š ç†è®ºèƒŒæ™¯

### æ‰§è¡Œå•å…ƒæ¶æ„

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚              Execute Unit (EXU)             â”‚
                    â”‚                                             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
    â”‚ Forward A â”‚â”€â”€â”€â”¼â”€â”€â–¶â”‚    MUX      â”‚â”€â”€â”€â”€â”€â–¶â”‚             â”‚     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚             â”‚     â”‚
                    â”‚          â–²              â”‚             â”‚     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”      â”‚             â”‚     â”‚
    â”‚  Rn Data  â”‚â”€â”€â”€â”¼â”€â”€â–¶â”‚             â”‚      â”‚     ALU     â”‚â”€â”€â”€â”€â”€â”¼â”€â”€â–¶ Result
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚             â”‚     â”‚
                    â”‚                         â”‚             â”‚     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚             â”‚     â”‚
    â”‚ Forward B â”‚â”€â”€â”€â”¼â”€â”€â–¶â”‚    MUX      â”‚â”€â”€â”€â”€â”€â–¶â”‚             â”‚     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                    â”‚          â–²                    â–²             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”       â”‚
    â”‚  Rm Data  â”‚â”€â”€â”€â”¼â”€â”€â–¶â”‚   Barrel    â”‚â”€â”€â”€â”€â”€â–¶â”‚  Shifter  â”‚       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚   Shifter   â”‚      â”‚   Carry   â”‚       â”‚
                    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                    â”‚                                             â”‚
                    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚             â”‚                          â”‚
    â”‚  Imm Data â”‚â”€â”€â”€â”¼â”€â”€â–¶â”‚  Imm MUX   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚             â”‚                          â”‚
                    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
                    â”‚                                             â”‚
                    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
                    â”‚   â”‚   Branch    â”‚â”€â”€â”€â”€â”€â–¶â”‚  Branch     â”‚â”€â”€â”€â”€â”€â”¼â”€â”€â–¶ Branch Target
                    â”‚   â”‚   Adder     â”‚      â”‚  Taken      â”‚     â”‚
                    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                    â”‚                                             â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‰é€’ï¼ˆForwardingï¼‰æœºåˆ¶

```
æ•°æ®å†’é™©ç¤ºä¾‹:
    ADD R1, R2, R3    @ EX: R1 = R2 + R3
    SUB R4, R1, R5    @ ID: éœ€è¦ R1ï¼Œä½† R1 å°šæœªå†™å›

å‰é€’è·¯å¾„:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   EX     â”‚â”€â”€â”€â”€â–¶â”‚   MEM    â”‚â”€â”€â”€â”€â–¶â”‚   WB     â”‚
    â”‚ (Result) â”‚     â”‚ (Result) â”‚     â”‚ (Result) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                â”‚
         â”‚                â”‚
         â–¼                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     Forwarding MUX         â”‚
    â”‚   é€‰æ‹©æœ€æ–°çš„æ•°æ®æº          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¡ä»¶æ‰§è¡Œ

ARM æ¯æ¡æŒ‡ä»¤éƒ½å¯ä»¥æ¡ä»¶æ‰§è¡Œï¼š

```verilog
function cond_pass;
    input [3:0] cond;
    input       N, Z, C, V;
    begin
        case (cond)
            4'b0000: cond_pass = Z;                      // EQ
            4'b0001: cond_pass = ~Z;                     // NE
            4'b0010: cond_pass = C;                      // CS/HS
            4'b0011: cond_pass = ~C;                     // CC/LO
            4'b0100: cond_pass = N;                      // MI
            4'b0101: cond_pass = ~N;                     // PL
            4'b0110: cond_pass = V;                      // VS
            4'b0111: cond_pass = ~V;                     // VC
            4'b1000: cond_pass = C & ~Z;                 // HI
            4'b1001: cond_pass = ~C | Z;                 // LS
            4'b1010: cond_pass = (N == V);               // GE
            4'b1011: cond_pass = (N != V);               // LT
            4'b1100: cond_pass = ~Z & (N == V);          // GT
            4'b1101: cond_pass = Z | (N != V);           // LE
            4'b1110: cond_pass = 1'b1;                   // AL
            4'b1111: cond_pass = 1'b0;                   // NV (reserved)
        endcase
    end
endfunction
```

---

## ğŸ“ ä»£ç å®ç°

è¯¦è§ `src/execute_unit.v`

---

## âœ… æ£€æŸ¥ç‚¹

- [ ] ALU å’Œ Shifter æ­£ç¡®é›†æˆ
- [ ] å‰é€’ MUX æ­£ç¡®é€‰æ‹©æ•°æ®æº
- [ ] åˆ†æ”¯ç›®æ ‡æ­£ç¡®è®¡ç®—
- [ ] æ¡ä»¶æ‰§è¡Œé€»è¾‘æ­£ç¡®
- [ ] NZCV æ ‡å¿—æ­£ç¡®æ›´æ–°

---

## ğŸ”— ä¸‹ä¸€æ­¥

å®Œæˆæœ¬å®éªŒåï¼Œç»§ç»­ **Lab 5: æ§åˆ¶å•å…ƒè®¾è®¡**ã€‚
